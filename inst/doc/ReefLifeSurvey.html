<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="CJ Brown" />

<meta name="date" content="2018-06-05" />

<title>Introduction to RLSPrivate</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Introduction to RLSPrivate</h1>
<h4 class="author"><em>CJ Brown</em></h4>
<h4 class="date"><em>2018-06-05</em></h4>



<p>This package provides access to the <a href="https://reeflifesurvey.com/">Reef Life Survey</a> data-base and helpful functions for analyising and visualising this extensive data source.</p>
<p>The citation for this data is: Edgar GJ, Stuart-Smith RD. Systematic global assessment of reef fish communities by the Reef Life Survey program. Scientific Data. 2014 May 27;1:140007.</p>
<div id="getting-started" class="section level2">
<h2>Getting started</h2>
<p>Once you have installed <code>RLSPrivate</code> then you can get access to the databases:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    <span class="kw">library</span>(RLSPrivate)
    <span class="kw">data</span>(rls)
    <span class="kw">data</span>(sdat)
    <span class="kw">data</span>(survdat)
    <span class="kw">data</span>(fdat)</code></pre></div>
<p><code>rls</code> is the main database of observations, <code>sdat</code> is a database of site covariates and <code>survdat</code> is a database of survey level covariates.</p>
<p>Weights are by default recorded in grams, so you may want to convert them to kg first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rls<span class="op">$</span>BioMass &lt;-<span class="st"> </span>rls<span class="op">$</span>BioMass<span class="op">/</span><span class="dv">1000</span> <span class="co">#convert to kg</span></code></pre></div>
</div>
<div id="all-metrics" class="section level2">
<h2>All metrics</h2>
<p>The general purpose function <code>allmetrics</code> will calculate a range of metrics of different types (biomass, diversity and functional groups) for a given grouping variable. Below we calculate all the metrics by <code>SurveyID</code>. We pass in two internal dataframes <code>cryptdat</code> and <code>invertclasses</code> which just specify which families belong to cryptic fish and invertebrates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(cryptdat)
<span class="kw">data</span>(invertclasses)

dout &lt;-<span class="st"> </span><span class="kw">allmetrics</span>(rls, SurveyID, <span class="dt">sdat =</span> sdat, <span class="dt">survdat =</span> survdat, <span class="dt">fdat =</span> fdat, <span class="dt">cryptdat =</span> cryptdat, <span class="dt">invertclasses =</span> invertclasses)
dout</code></pre></div>
<pre><code># A tibble: 45,833 x 10
   SurveyID        m1_alpha m1_biomass   B20 m2_fish_alpha m2_invert_alpha
   &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;
 1 M00010500272011       7.      11.4  11.2             NA              NA
 2 M00010500272012       8.      12.0  10.3             NA              NA
 3 M00010500272013       5.      23.6  21.9             NA              NA
 4 M00010500272014       4.      14.8  14.8             NA              NA
 5 M00010500273011       5.       6.70  6.55            NA              NA
 6 M00010500273012       4.       8.06  8.06            NA              NA
 7 M00010500273013       5.       9.61  9.61            NA              NA
 8 M00010500273014       2.       1.70  1.70            NA              NA
 9 M00010500274011       4.       7.30  6.97            NA              NA
10 M00010500274012       6.       8.36  8.26            NA              NA
# ... with 45,823 more rows, and 4 more variables: FG_richness &lt;dbl&gt;,
#   biomass &lt;dbl&gt;, CTI &lt;dbl&gt;, urchin_abundance &lt;dbl&gt;</code></pre>
</div>
<div id="diversity-and-biomass-metrics" class="section level2">
<h2>Diversity and biomass metrics</h2>
<p>You can calculate a range of metrics using the <code>calcmetrics</code> function, such as the alpha diversity:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   <span class="kw">calcmetrics</span>(rls, <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>))</code></pre></div>
<pre><code>Warning in calcmetrics(rls, metrics = c(&quot;alpha&quot;)): You are pooling metrics
across &gt;1 method. Consider filtering input data for a single method first.</code></pre>
<pre><code># A tibble: 1 x 1
  alpha
  &lt;dbl&gt;
1  10.9</code></pre>
<p>This will pass a warning to let you know you are calculating alpha diversity across multiple methods. You could filter <code>rls</code> for a single method, see example for functional groups below.</p>
<p>The data-frame <code>calcmetrics</code> can also take a grouping variable as input (must be a named variable in the data.frame at hand). For instance, to calculate the biomass of fish &gt;40cm:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">head</span>(<span class="kw">calcmetrics</span>(rls, SurveyID, <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&quot;bioatsize&quot;</span>), <span class="dt">sizecat =</span> <span class="dv">40</span>))</code></pre></div>
<pre><code>Warning in calcmetrics(rls, SurveyID, metrics = c(&quot;bioatsize&quot;), sizecat
= 40): You are pooling metrics across &gt;1 method. Consider filtering input
data for a single method first.</code></pre>
<pre><code># A tibble: 6 x 2
  SurveyID        bioatsize
  &lt;chr&gt;               &lt;dbl&gt;
1 M00010500272011     0.   
2 M00010500272012     0.983
3 M00010500272013     0.695
4 M00010500272014     0.   
5 M00010500272021     0.   
6 M00010500272022     0.   </code></pre>
<p>You could also join <code>survdat</code> to site level data to calculate site level alpha diversity (i.e. average number of fish observed on all surveys at that site):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    <span class="co">#alpha diversity</span>
    rls <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">inner_join</span>(survdat) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">calcmetrics</span>(SiteCode, <span class="dt">metrics =</span> <span class="st">&quot;alpha&quot;</span>)</code></pre></div>
<pre><code>Joining, by = &quot;SurveyID&quot;</code></pre>
<pre><code>Warning in calcmetrics(., SiteCode, metrics = &quot;alpha&quot;): You are pooling
metrics across &gt;1 method. Consider filtering input data for a single method
first.</code></pre>
<pre><code># A tibble: 2,530 x 2
   SiteCode alpha
   &lt;chr&gt;    &lt;dbl&gt;
 1 0001      5.73
 2 0002      8.01
 3 0003      7.48
 4 0004      5.83
 5 0005      6.78
 6 0006      9.23
 7 0007      7.18
 8 0008      3.81
 9 0009      6.88
10 0010      8.90
# ... with 2,520 more rows</code></pre>
<p>If you want to know gamma diversity (total number of species observed at a site), then use the <code>nspp</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    <span class="co">#gamma diversity by sites </span>
    rls <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">inner_join</span>(survdat) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">nspp</span>(SiteCode)</code></pre></div>
<pre><code>Joining, by = &quot;SurveyID&quot;</code></pre>
<pre><code># A tibble: 2,530 x 2
   SiteCode richness
   &lt;chr&gt;       &lt;int&gt;
 1 0001           59
 2 0002          106
 3 0003           60
 4 0004           39
 5 0005           91
 6 0006          124
 7 0007           48
 8 0008           23
 9 0009           40
10 0010           22
# ... with 2,520 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
    <span class="co">#gamma diversity by ecoregions</span>
   rls <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">inner_join</span>(survdat) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">inner_join</span>(sdat) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">nspp</span>(Ecoregion)</code></pre></div>
<pre><code>Joining, by = &quot;SurveyID&quot;</code></pre>
<pre><code>Joining, by = &quot;SiteCode&quot;</code></pre>
<pre><code># A tibble: 21 x 2
   Ecoregion                               richness
   &lt;chr&gt;                                      &lt;int&gt;
 1 Arnhem Coast to Gulf of Carpenteria          459
 2 Bassian                                      543
 3 Bonaparte Coast                              379
 4 Cape Howe                                    728
 5 Central and Southern Great Barrier Reef     1099
 6 Cocos-Keeling/Christmas Island               285
 7 Coral Sea                                    962
 8 Exmouth to Broome                           1051
 9 Great Australian Bight                       158
10 Gulf of Papua                                394
# ... with 11 more rows</code></pre>
</div>
<div id="functional-group-metrics" class="section level2">
<h2>Functional group metrics</h2>
<p>If you want to get biomass of different functional groups, then use <code>tgroup_metrics()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flim &lt;-<span class="st"> </span>fdat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SpeciesID, Class, TrophicGroup)

herbs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;browsing herbivore&quot;</span>, <span class="st">&quot;scraping herbivore&quot;</span>, <span class="st">&quot;excavator&quot;</span>, <span class="st">&quot;algal farmer&quot;</span>)

r2 &lt;-<span class="st"> </span>rls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Method <span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(survdat) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(sdat)</code></pre></div>
<pre><code>Joining, by = &quot;SurveyID&quot;</code></pre>
<pre><code>Joining, by = &quot;SiteCode&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fout &lt;-<span class="st"> </span><span class="kw">tgroup_metrics</span>(r2, Location, Ecoregion, <span class="dt">tgroups =</span> herbs, <span class="dt">traits =</span> flim, <span class="dt">na.rm =</span> T, <span class="dt">metrics =</span> <span class="st">&quot;biomass&quot;</span>)

<span class="kw">hist</span>(fout<span class="op">$</span>biomass)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="community-temperature-index" class="section level2">
<h2>Community temperature index</h2>
<p>The community temperature index is calculated for a survey as: <span class="math display">\[\frac{\sum^n_i{T_j B_{i,j}}}{\sum^n_i{B_{i,j}}}\]</span> Where there are <span class="math inline">\(n\)</span> surveys <span class="math inline">\(i\)</span>,<span class="math inline">\(T_j\)</span> are the species thermal indexes (e.g. thermal midpoint from a species range) and <span class="math inline">\(B_{i,j}\)</span> are the biomasses or abundances of each species at each site.</p>
<p>For instance, to calculate the CTI for locations and ecoregions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flim &lt;-<span class="st"> </span>fdat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SpeciesID, Class, Family, ThermalMP_5_<span class="dv">95</span>)

r2 &lt;-<span class="st"> </span>rls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Method <span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(survdat) <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">inner_join</span>(sdat) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(flim) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(Class <span class="op">%in%</span><span class="st"> </span><span class="kw">fish_classes</span>())</code></pre></div>
<pre><code>Joining, by = &quot;SurveyID&quot;</code></pre>
<pre><code>Joining, by = &quot;SiteCode&quot;</code></pre>
<pre><code>Joining, by = &quot;SpeciesID&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> xout &lt;-<span class="st"> </span>r2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">commtempindex</span>(Location, Ecoregion, <span class="dt">tempvar =</span> <span class="st">&quot;ThermalMP_5_95&quot;</span>, <span class="dt">abundvar =</span> <span class="st">&quot;BioMass&quot;</span>, <span class="dt">dolog =</span> <span class="ot">TRUE</span>)
<span class="kw">hist</span>(xout<span class="op">$</span>CTI)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
